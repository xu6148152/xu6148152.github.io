<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Animator at Android | Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Animator其是Android3.0之后加入的作用于对象属性的动画,Animator是所有属性动画的基类，其下有ValueAnimator,AnimatorSet,由ValueAnimator再拓展出ObjectAnimator,TimeAnimator 其整体结构图  ValueAnimator为作用对象提供简单的能够计算动画时间和值得时间引擎，它运行在自定义的Handler里面以确保所有的">
<meta property="og:type" content="article">
<meta property="og:title" content="Animator at Android">
<meta property="og:url" content="http://xu6148152.github.io/2016/12/04/Animator-at-Android/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="Animator其是Android3.0之后加入的作用于对象属性的动画,Animator是所有属性动画的基类，其下有ValueAnimator,AnimatorSet,由ValueAnimator再拓展出ObjectAnimator,TimeAnimator 其整体结构图  ValueAnimator为作用对象提供简单的能够计算动画时间和值得时间引擎，它运行在自定义的Handler里面以确保所有的">
<meta property="og:locale">
<meta property="og:image" content="http://xu6148152.github.io/animator.png">
<meta property="og:image" content="http://xu6148152.github.io/ValueAnimator.png">
<meta property="og:image" content="http://xu6148152.github.io/interpolator.png">
<meta property="og:image" content="http://xu6148152.github.io/LinearInterpolator.png">
<meta property="og:image" content="http://xu6148152.github.io/AccelerateDecelerateInterpolator.png">
<meta property="og:image" content="http://xu6148152.github.io/AccelerateInterpolator.png">
<meta property="og:image" content="http://xu6148152.github.io/AnticipateInterpolator.png">
<meta property="og:image" content="http://xu6148152.github.io/AnticipateOvershootinterpolator.png">
<meta property="og:image" content="http://xu6148152.github.io/TypeEvaluator.png">
<meta property="og:image" content="http://xu6148152.github.io/transition.png">
<meta property="article:published_time" content="2016-12-04T13:17:02.000Z">
<meta property="article:modified_time" content="2016-12-25T10:33:39.000Z">
<meta property="article:author" content="Binea">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xu6148152.github.io/animator.png">
  
    <link rel="alternate" href="/atom.xml" title="Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://xu6148152.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Animator-at-Android" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/04/Animator-at-Android/" class="article-date">
  <time datetime="2016-12-04T13:17:02.000Z" itemprop="datePublished">2016-12-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Animator at Android
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Animator"><a href="#Animator" class="headerlink" title="Animator"></a>Animator</h3><p>其是<code>Android3.0</code>之后加入的作用于对象属性的动画,<code>Animator</code>是所有属性动画的基类，其下有<code>ValueAnimator</code>,<code>AnimatorSet</code>,由<code>ValueAnimator</code>再拓展出<code>ObjectAnimator</code>,<code>TimeAnimator</code></p>
<p>其整体结构图</p>
<p><img data-src="/./animator.png" alt="animator"></p>
<h4 id="ValueAnimator"><a href="#ValueAnimator" class="headerlink" title="ValueAnimator"></a>ValueAnimator</h4><p>为作用对象提供简单的能够计算动画时间和值得时间引擎，它运行在自定义的<code>Handler</code>里面以确保所有的属性改变都会在<code>UI</code>线程。主要<code>API</code>:</p>
<p>&lt;!–code￼0–&gt;
</p>
<p>这些方法里面都是进行值得初始化</p>
<p>&lt;!–code￼1–&gt;
</p>
<p>都是重新封装转化成<code>PropertyValuesHolder</code>，这是封装动画属性和值得对象，之后会详细介绍</p>
<p>&lt;!–code￼2–&gt;
</p>
<p>设置估值器，最后也是由<code>PropertyValuesHolder</code>保存</p>
<p>&lt;!–code￼3–&gt;
</p>
<p>开始动画的逻辑其实很简单，主要是判断动画是否需要反转。最终动画的更新交给<code>AnimationHandler</code></p>
<h5 id="AnimationHandler"><a href="#AnimationHandler" class="headerlink" title="AnimationHandler"></a>AnimationHandler</h5><p>处理所有运行中的动画的定时脉冲，这个机制能确保所有的动画都运行在<code>UI</code>线程，其使用<code>Choreograhper(用于调整动画输入和绘制的时机)</code>来执行周期的回调</p>
<p>&lt;!–code￼4–&gt;
</p>
<p>流程图</p>
<p><img data-src="/./ValueAnimator.png" alt="ValueAnimator"></p>
<h4 id="插值器"><a href="#插值器" class="headerlink" title="插值器"></a>插值器</h4><p>插值器是描述动画变化的频率。其主要方法是  </p>
<p>&lt;!–code￼5–&gt;
</p>
<p>类关系图:<br><img data-src="/./interpolator.png" alt="interpolator"></p>
<p>系统已经为开发者准备了一些默认的插值器，我们来简单看下这些插值器的算法</p>
<h5 id="LinearInterpolator-线性插值器"><a href="#LinearInterpolator-线性插值器" class="headerlink" title="LinearInterpolator(线性插值器)"></a>LinearInterpolator(线性插值器)</h5><p>&lt;!–code￼6–&gt;
</p>
<p><img data-src="/./LinearInterpolator.png"></p>
<h5 id="AccelerateDecelerateInterpolator-加减速插值器"><a href="#AccelerateDecelerateInterpolator-加减速插值器" class="headerlink" title="AccelerateDecelerateInterpolator(加减速插值器)"></a>AccelerateDecelerateInterpolator(加减速插值器)</h5><p>&lt;!–code￼7–&gt;
</p>
<p><img data-src="/./AccelerateDecelerateInterpolator.png">  </p>
<p>其特性是在动画开始和结束阶段变化缓慢，中间阶段变化迅速</p>
<h5 id="AccelerateInterpolator-加速插值器"><a href="#AccelerateInterpolator-加速插值器" class="headerlink" title="AccelerateInterpolator(加速插值器)"></a>AccelerateInterpolator(加速插值器)</h5><p>&lt;!–code￼8–&gt;
</p>
<p><img data-src="/./AccelerateInterpolator.png"><br>其特点是动画变化速度一直加快，有个加速因子，默认为1。</p>
<h5 id="AnticipateInterpolator"><a href="#AnticipateInterpolator" class="headerlink" title="AnticipateInterpolator"></a>AnticipateInterpolator</h5><p>&lt;!–code￼9–&gt;
</p>
<p><img data-src="/./AnticipateInterpolator.png"></p>
<h5 id="AnticipateOvershootInterpolator"><a href="#AnticipateOvershootInterpolator" class="headerlink" title="AnticipateOvershootInterpolator"></a>AnticipateOvershootInterpolator</h5><p>&lt;!–code￼10–&gt;
</p>
<p><img data-src="/./AnticipateOvershootinterpolator.png"></p>
<p>还有很多别的插值器。这里就不多加赘述了。只要将相应的算法写入<code>getInterpolation</code>中即可</p>
<p>使用的地方</p>
<p>&lt;!–code￼11–&gt;
</p>
<h4 id="TypeEvaluator-估值器"><a href="#TypeEvaluator-估值器" class="headerlink" title="TypeEvaluator(估值器)"></a>TypeEvaluator(估值器)</h4><p>根据当前的动画频率，起始值，结束值计算当前值</p>
<p><img data-src="/./TypeEvaluator.png"></p>
<p>&lt;!–code￼12–&gt;
</p>
<h5 id="ArgbEvaluator"><a href="#ArgbEvaluator" class="headerlink" title="ArgbEvaluator"></a>ArgbEvaluator</h5><p>&lt;!–code￼13–&gt;
</p>
<p>算法是线性函数，主要因子<code>fraction</code>来自插值器的计算, <code>y= a + kx</code></p>
<h5 id="IntEvaluator"><a href="#IntEvaluator" class="headerlink" title="IntEvaluator"></a>IntEvaluator</h5><p>&lt;!–code￼14–&gt;
</p>
<p>估值器主要实在<code>KeyFrames</code>中使用，而<code>KeyFrames</code>存在<code>PropertyValuesHolder</code>当中，最终<code>Choreographer</code>来更新动画使用</p>
<h4 id="Choreograhper"><a href="#Choreograhper" class="headerlink" title="Choreograhper"></a>Choreograhper</h4><p>协调动画，输入和绘制的时间。其会收到来自显示系统的定时脉冲，然后安排工作作为下一帧渲染的一部分。</p>
<p>&lt;!–code￼15–&gt;
</p>
<ul>
<li>初始化，创建<code>FrameHandler</code>，创建回调队列</li>
</ul>
<p>&lt;!–code￼16–&gt;
</p>
<ul>
<li>将回调加入回调队列，如果没有延时，锁定当前帧，如果使用<code>VSYNC</code>，诺当前运行在相同的线程，直接通过<code>FrameDisplayEventReceiver</code>要求同步，其他情况发送消息到<code>Handler</code>中执行。<code>Handler</code>处理三种消息,<code>MSG_DO_FRAME</code>,<code>MSG_DO_SCHEDULE_VSYNC</code>, <code>MSG_DO_SCHEDULE_CALLBACK</code></li>
</ul>
<p>&lt;!–code￼17–&gt;
</p>
<ul>
<li><code>MSG_DO_FRAME</code>:判断当前帧时间，低于上次绘制时间，要求同步。否则调用<code>doCallbacks</code>，执行回调队列中的回调</li>
</ul>
<h5 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h5><h4 id="ObjectAnimator"><a href="#ObjectAnimator" class="headerlink" title="ObjectAnimator"></a>ObjectAnimator</h4><p>支持对目标对象的属性做动画，对<code>ValueAnimator</code>的拓展</p>
<p>&lt;!–code￼18–&gt;
</p>
<ul>
<li><code>ObjectAnimator</code>比<code>ValueAnimator</code>多了<code>target</code>和<code>Property</code>，这些信息都在<code>PropertyValuesHolder</code>,必须要要有getter&#x2F;setter才能更新目标对象</li>
</ul>
<h4 id="PropertyValuesHolder-处理setter-getter的寻找"><a href="#PropertyValuesHolder-处理setter-getter的寻找" class="headerlink" title="PropertyValuesHolder 处理setter, getter的寻找"></a>PropertyValuesHolder 处理setter, getter的寻找</h4><p>&lt;!–code￼19–&gt;
</p>
<ul>
<li><code>PropertyValuesHolder</code>主要持有动画的相关属性信息，包括关键帧集，插值器，估值器等</li>
</ul>
<h4 id="KeyFrame"><a href="#KeyFrame" class="headerlink" title="KeyFrame"></a>KeyFrame</h4><p>动画关键帧，保存动画某一帧的时间&#x2F;值。被<code>ValueAnimator</code>使用来计算两个值之间的动画值。<code>PropertyValuesHolder</code>保存了<code>KeyFrames</code>其保存了多个<code>KeyFrame</code>。简单来说<code>KeyFrame</code>就是我们做动画的起始值，中间值，结束值，这些都是由开发者定义。</p>
<p>&lt;!–code￼20–&gt;
</p>
<ul>
<li>动画至少会包含两个关键帧，一个起始关键帧，一个结束关键帧。中间有多少关键帧由开发者自行定义</li>
</ul>
<h4 id="AnimatorSet"><a href="#AnimatorSet" class="headerlink" title="AnimatorSet"></a>AnimatorSet</h4><p>允许同时播放多个动画或者定义动画的播放顺序</p>
<p>&lt;!–code￼21–&gt;
</p>
<ul>
<li>流程: <ol>
<li>首先禁止异步运行动画，设置所有动画的时间和插值器。</li>
<li>对所有的动画进行排序(根据依赖关系),取消所有老的监听。如果动画没有依赖，加入即将开始的动画队列，否则创建依赖监听，创建临时依赖</li>
<li>没有延时，启动动画。否则创建延时动画，延时动画结束后，后续动画开始</li>
<li>动画开始监听回调，如果没有动画，动画结束监听回调</li>
</ol>
</li>
</ul>
<p>&lt;!–code￼22–&gt;
</p>
<ul>
<li>包含两个规则，一起，后续</li>
</ul>
<p>&lt;!–code￼23–&gt;
</p>
<h4 id="LayoutTransition"><a href="#LayoutTransition" class="headerlink" title="LayoutTransition"></a>LayoutTransition</h4><p><code>ViewGroup</code>布局发生改变时播放动画。这个动画的核心概念是两个类型的改变会引起四种不同的动画运行。这两种改变时<code>appearing</code>和<code>disappearing</code>。</p>
<p>&lt;!–code￼24–&gt;
</p>
<p>动画类型，用一个字节表示</p>
<p>&lt;!–code￼25–&gt;
</p>
<ul>
<li>主要流程<ol>
<li>启动一个延时动画来移除为执行的动画</li>
<li>监听布局变化,如果是<code>ValueAnimator</code>，判断起始帧和结束帧是否一样，如果一样表示结束.否则根据布局改变的原因设置动画类型，开始动画</li>
<li>移除缓存动画</li>
</ol>
</li>
</ul>
<h4 id="ViewPropertyAnimator"><a href="#ViewPropertyAnimator" class="headerlink" title="ViewPropertyAnimator"></a>ViewPropertyAnimator</h4><p>自动优化<code>View</code>对象的属性动画。如果想做1个或者两个属性动画，使用<code>ObjectAnimator</code>，其也可以设置属性值，合理的刷新视图。但是如果有多个属性要同时动画，或者想要使用更简洁的语法，那么可以使用<code>ViewPropertyAnimator</code></p>
<p>&lt;!–code￼26–&gt;
</p>
<ul>
<li>上述流程, 做属性动画都会调用<code>animateProperty</code>，其内部会调用<code>animatePropertyBy</code><ol>
<li>首先会取消这个属性上存在的动画</li>
<li>构建<code>NameValuesHolder</code></li>
<li>调用<code>removeCallbacks(runnable)</code>，取消之前动画</li>
<li>调用<code>postOnAnimation(runnable)</code>，开始动画</li>
</ol>
</li>
</ul>
<h3 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h3><p>主要用于做转场动画，其会保存场景转变的信息。任何转变有两个主要工作: 1. 捕获属性值 2. 基于捕获的属性值改变做动画。**无法与<code>TextureView</code>和<code>SurfaceView</code>一起使用。对于<code>SurfaceView</code>，由于其是从非UI线程更新UI，因此会造成不同步。对于<code>TextureView</code>，由于转场动画依赖<code>ViewOverlay</code>，而其又无法与<code>TextureView</code>一起工作。</p>
<h4 id="结构图"><a href="#结构图" class="headerlink" title="结构图"></a>结构图</h4><p><img data-src="/./transition.png" alt="transition"></p>
<p>&lt;!–code￼27–&gt;
</p>
<h5 id="开始转场动画"><a href="#开始转场动画" class="headerlink" title="开始转场动画"></a>开始转场动画</h5><p>&lt;!–code￼28–&gt;
</p>
<ul>
<li>流程<ol>
<li>未设置<code>Transition</code>，使用默认<code>Transition</code>，也就是<code>AutoTransition</code></li>
<li>暂停当前正在运行的转场动画，捕获当前场景，取消之前的转场动画</li>
<li>设置当前场景</li>
<li>设置绘制(<code>preDraw</code>)监听，在其当中捕获场景和开始转场动画</li>
</ol>
</li>
</ul>
<h5 id="AutoTransition"><a href="#AutoTransition" class="headerlink" title="AutoTransition"></a>AutoTransition</h5><p>组合转场动画，包括渐变和区域改变。<code>Transition</code>由<code>TransitionManger</code>管理。一般可以使用<code>beginDelayedTransition</code>开始一个转场动画，默认的转场动画为<code>AutoTransition</code>:</p>
<p>&lt;!–code￼29–&gt;
</p>
<p>效果如下:</p>
<p>&lt;!–swig￼49–&gt;
</p>
<h6 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h6><blockquote>
<p>继承自TransitionSet</p>
</blockquote>
<p>&lt;!–code￼30–&gt;
</p>
<ul>
<li>顺序播放渐出，区域变化，渐入动画</li>
</ul>
<h5 id="TransitionSet"><a href="#TransitionSet" class="headerlink" title="TransitionSet"></a>TransitionSet</h5><blockquote>
<p>继承自Transition</p>
</blockquote>
<p>&lt;!–code￼31–&gt;
</p>
<ul>
<li>调用各个<code>Transition</code>的方法</li>
</ul>
<p>&lt;!–code￼32–&gt;
</p>
<ul>
<li>使用各自<code>Transition</code>创建动画。为第一个转场动画设置必要的延时</li>
</ul>
<p>&lt;!–code￼33–&gt;
</p>
<ul>
<li>动画开始，由各个<code>Transition</code>开始动画，在这里会区分动画是串行播放，还是并行播放。</li>
</ul>
<h5 id="ChangeText-自定义transition"><a href="#ChangeText-自定义transition" class="headerlink" title="ChangeText(自定义transition)"></a>ChangeText(自定义transition)</h5><p>&lt;!–swig￼50–&gt;
</p>
<p>&lt;!–code￼34–&gt;
</p>
<ul>
<li>上述代码也能实现相同的功能，<code>ChangeText</code>只是对其进行了进一步的封装。这里不分析其源码</li>
</ul>
<h5 id="ChangeBound"><a href="#ChangeBound" class="headerlink" title="ChangeBound"></a>ChangeBound</h5><p>&lt;!–swig￼51–&gt;
</p>
<h6 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析"></a>源码分析</h6><blockquote>
<p>继承<code>Transition</code></p>
</blockquote>
<p>&lt;!–code￼35–&gt;
</p>
<ul>
<li>保存当前<code>View</code>的边界状态</li>
</ul>
<blockquote>
<p>创建动画，代码很长，核心代码</p>
</blockquote>
<p>&lt;!–code￼36–&gt;
</p>
<ul>
<li>主要功能是判断<code>View</code>的边界有没有发生改变，如果发生改变，使用对应的位置变化动画，主要包括<code>topLeft, bottomRight, position</code>。如果没有发生改变，则在<code>View</code>上绘制<code>Overlay</code>并对其做<code>path</code>动画。</li>
</ul>
<p>设置<code>pathMotion</code></p>
<blockquote>
<p>其是一个抽象类，用于描述<code>Transition</code>的<code>Path</code>信息</p>
</blockquote>
<p>&lt;!–swig￼52–&gt;
</p>
<p>&lt;!–code￼37–&gt;
</p>
<ul>
<li>实现<code>getPath</code>以便提供两点之间的变化频率</li>
</ul>
<h5 id="Slide"><a href="#Slide" class="headerlink" title="Slide"></a>Slide</h5><blockquote>
<p>继承自<code>Visibility</code></p>
</blockquote>
<p>&lt;!–swig￼53–&gt;
</p>
<h6 id="源码分析-2"><a href="#源码分析-2" class="headerlink" title="源码分析"></a>源码分析</h6><p>&lt;!–code￼38–&gt;
</p>
<ul>
<li>保存当前<code>View</code>位置</li>
</ul>
<blockquote>
<p>其<code>createAnimator</code>在父类<code>Visibility</code>中被重写，当中调用<code>onAppear</code>和<code>onDisappear</code>，这两个方法分别有各自的重载方法，由子类提供具体的实现，默认无动画</p>
</blockquote>
<p>&lt;!–code￼39–&gt;
</p>
<ul>
<li>使用<code>CalculateSlide</code>接口的实现计算<code>View</code>离开或者进入场景时的位置，最后由<code>TranslationAnimationCreator</code>创建动画</li>
</ul>
<h5 id="Scale"><a href="#Scale" class="headerlink" title="Scale"></a>Scale</h5><p>&lt;!–swig￼54–&gt;
</p>
<p>设置<code>alpha</code></p>
<p>&lt;!–swig￼55–&gt;
</p>
<h6 id="源码分析-3"><a href="#源码分析-3" class="headerlink" title="源码分析"></a>源码分析</h6><p>private Animator createAnimation(final View view, float startScale, float endScale, TransitionValues values) {
        final float initialScaleX &#x3D; view.getScaleX();
        final float initialScaleY &#x3D; view.getScaleY();
        float startScaleX &#x3D; initialScaleX * startScale;
        float endScaleX &#x3D; initialScaleX * endScale;
        float startScaleY &#x3D; initialScaleY * startScale;
        float endScaleY &#x3D; initialScaleY * endScale;</p>
<pre><code>    if (values != null) &#123;
        Float savedScaleX = (Float) values.values.get(PROPNAME_SCALE_X);
        Float savedScaleY = (Float) values.values.get(PROPNAME_SCALE_Y);
        // if saved value is not equal initial value it means that previous
        // transition was interrupted and in the onTransitionEnd
        // we&#39;ve applied endScale. we should apply proper value to
        // continue animation from the interrupted state
        if (savedScaleX != null &amp;&amp; savedScaleX != initialScaleX) &#123;
            startScaleX = savedScaleX;
        &#125;
        if (savedScaleY != null &amp;&amp; savedScaleY != initialScaleY) &#123;
            startScaleY = savedScaleY;
        &#125;
    &#125;

    view.setScaleX(startScaleX);
    view.setScaleY(startScaleY);

    Animator animator = TransitionUtils.mergeAnimators(
            ObjectAnimator.ofFloat(view, View.SCALE_X, startScaleX, endScaleX),
            ObjectAnimator.ofFloat(view, View.SCALE_Y, startScaleY, endScaleY));
    addListener(new TransitionListenerAdapter() &#123;
        @Override
        public void onTransitionEnd(Transition transition) &#123;
            view.setScaleX(initialScaleX);
            view.setScaleY(initialScaleY);
        &#125;
    &#125;);
    return animator;
</code></pre>
<p>}</p>
<ul>
<li>合并<code>x, y</code>缩放的动画，合并是采用<code>TransitionSet</code>，如下</li>
</ul>
<p>&lt;!–code￼40–&gt;
</p>
<h5 id="Explode"><a href="#Explode" class="headerlink" title="Explode"></a>Explode</h5><blockquote>
<p>继承自Visibility</p>
</blockquote>
<p>&lt;!–swig￼56–&gt;
</p>
<h6 id="源码分析-4"><a href="#源码分析-4" class="headerlink" title="源码分析"></a>源码分析</h6><p>&lt;!–code￼41–&gt;
</p>
<ul>
<li>通过<code>calculateOut</code>计算扩散的距离，使用<code>TranslationAnimationCreator</code>创建动画</li>
</ul>
<p>&lt;!–code￼42–&gt;
</p>
<ul>
<li>计算场景动画的偏移量，如果为0，随机算出偏移量，算出x, y偏移量的平方根，求出最大距离<h5 id="TransitionName"><a href="#TransitionName" class="headerlink" title="TransitionName"></a>TransitionName</h5></li>
</ul>
<blockquote>
<p>设置要做动画的标识，在之后的动画中会对这些标识的<code>View</code>做动画</p>
</blockquote>
<p>&lt;!–swig￼57–&gt;
</p>
<h5 id="ImageTransform"><a href="#ImageTransform" class="headerlink" title="ImageTransform"></a>ImageTransform</h5><p>&lt;!–swig￼58–&gt;
</p>
<h5 id="ReColor"><a href="#ReColor" class="headerlink" title="ReColor"></a>ReColor</h5><p>&lt;!–swig￼59–&gt;
</p>
<h5 id="Rotate"><a href="#Rotate" class="headerlink" title="Rotate"></a>Rotate</h5><blockquote>
<p>继承自Transition的旋转动画</p>
</blockquote>
<p>&lt;!–swig￼60–&gt;
</p>
<h6 id="源码分析-5"><a href="#源码分析-5" class="headerlink" title="源码分析"></a>源码分析</h6><p>&lt;!–code￼43–&gt;
</p>
<ul>
<li>创建旋转动画</li>
</ul>
<h5 id="Progress"><a href="#Progress" class="headerlink" title="Progress"></a>Progress</h5><p>&lt;!–swig￼61–&gt;
</p>
<h5 id="Change-Scene"><a href="#Change-Scene" class="headerlink" title="Change Scene"></a>Change Scene</h5><p>&lt;!–swig￼62–&gt;
</p>
<h6 id="源码分析-6"><a href="#源码分析-6" class="headerlink" title="源码分析"></a>源码分析</h6><p>&lt;!–code￼44–&gt;
</p>
<ul>
<li>先淡出效果(<code>Fade</code>)，改变区域(<code>ChangeBound</code>)，淡入效果(<code>Fade</code>)</li>
</ul>
<h5 id="Fade"><a href="#Fade" class="headerlink" title="Fade"></a>Fade</h5><p>渐变转场动画，继承自<code>Visibility</code></p>
<p>&lt;!–code￼45–&gt;
</p>
<ul>
<li>捕获初始场景的<code>alpha</code>值</li>
</ul>
<p>&lt;!–code￼46–&gt;
</p>
<ul>
<li>创建渐变属性动画，其会由<code>onAppear()</code>和<code>onDisAppear</code>调用</li>
</ul>
<p>&lt;!–code￼47–&gt;
</p>
<ul>
<li>这两个方法由<code>Visibility</code>的<code>createAnimator</code>调用</li>
</ul>
<p>&lt;!–code￼48–&gt;
</p>
<ul>
<li><code>View</code>显示或隐藏时会创建对应的渐变动画。<code>Transition</code>的<code>playTransition</code>会调用<code>createAnimators</code>，其内部会调用<code>createAnimator</code>。</li>
<li>整体流程是启动<code>Transition</code>-&gt;创建动画(<code>createAnimators</code>)-&gt;创建单个动画(<code>createAnimator</code>由<code>Transition</code>子类实现,默认空)-&gt;<code>Visibility</code>的<code>onAppear()</code>&#x2F;<code>onDisappear</code>-&gt;子类<code>createAnimator</code></li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h3><blockquote>
<p><code>Transition</code>动画其实是对属性动画的一种高级封装。其主要流程是<code>TransitionManager</code>调用<code>beginDelayedTransition</code>,内部监听了<code>OnPreDrawListener</code>，其在<code>onPreDraw</code>调用<code>captureView</code>用于获取当前<code>View</code>的状态,调用<code>playTransition</code>开始转场动画。之后创建动画<code>createAnimator</code>。这其中<code>captureView</code>都是由子类实现，而<code>createAnimator</code>则可以由子类选择重写。最终动画的开始还有调用<code>animator.start()</code></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xu6148152.github.io/2016/12/04/Animator-at-Android/" data-id="cl45dkwf8000y69kcghhc7vap" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/12/31/2016%E6%80%BB%E7%BB%93/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          2016总结
        
      </div>
    </a>
  
  
    <a href="/2016/12/03/Picasso%E8%A7%A3%E6%9E%90/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Picasso解析</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-AOSP/" rel="tag">Android AOSP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-source-analysis/" rel="tag">Android source analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android%E6%BA%90%E7%A0%81/" rel="tag">Android源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Binder-Hook-Android-Framework/" rel="tag">Binder Hook Android Framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FFMpeg4-1-ndkr18b/" rel="tag">FFMpeg4.1 ndkr18b</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Framework/" rel="tag">Framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Framework-Hook/" rel="tag">Framework, Hook</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hook-Framework-Android/" rel="tag">Hook, Framework, Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ionic-CI-Python/" rel="tag">Ionic, CI, Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-NIO/" rel="tag">Java NIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenGL/" rel="tag">OpenGL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python-%E5%B9%B6%E5%8F%91/" rel="tag">Python, 并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="tag">SpringCloud源码解析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ZooKeeper/" rel="tag">ZooKeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/" rel="tag">Zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/framework/" rel="tag">framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang-Channel/" rel="tag">golang Channel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90%E5%BA%93%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" rel="tag">开源库源码分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag">性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" rel="tag">源码分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 16.67px;">Android</a> <a href="/tags/Android-AOSP/" style="font-size: 10px;">Android AOSP</a> <a href="/tags/Android-source-analysis/" style="font-size: 10px;">Android source analysis</a> <a href="/tags/Android%E6%BA%90%E7%A0%81/" style="font-size: 10px;">Android源码</a> <a href="/tags/Binder-Hook-Android-Framework/" style="font-size: 10px;">Binder Hook Android Framework</a> <a href="/tags/FFMpeg4-1-ndkr18b/" style="font-size: 10px;">FFMpeg4.1 ndkr18b</a> <a href="/tags/Framework/" style="font-size: 10px;">Framework</a> <a href="/tags/Framework-Hook/" style="font-size: 10px;">Framework, Hook</a> <a href="/tags/Golang/" style="font-size: 10px;">Golang</a> <a href="/tags/Hook-Framework-Android/" style="font-size: 10px;">Hook, Framework, Android</a> <a href="/tags/Ionic-CI-Python/" style="font-size: 10px;">Ionic, CI, Python</a> <a href="/tags/Java-NIO/" style="font-size: 10px;">Java NIO</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/OpenGL/" style="font-size: 10px;">OpenGL</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/Python-%E5%B9%B6%E5%8F%91/" style="font-size: 10px;">Python, 并发</a> <a href="/tags/SpringCloud/" style="font-size: 10px;">SpringCloud</a> <a href="/tags/SpringCloud%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" style="font-size: 10px;">SpringCloud源码解析</a> <a href="/tags/ZooKeeper/" style="font-size: 10px;">ZooKeeper</a> <a href="/tags/Zookeeper/" style="font-size: 10px;">Zookeeper</a> <a href="/tags/framework/" style="font-size: 10px;">framework</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/golang-Channel/" style="font-size: 10px;">golang Channel</a> <a href="/tags/%E5%BC%80%E6%BA%90%E5%BA%93%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" style="font-size: 10px;">开源库源码分析</a> <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size: 10px;">性能优化</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 10px;">总结</a> <a href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" style="font-size: 13.33px;">源码分析</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">编程</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/06/08/fresco-memory-cache/">fresco之内存bitmap缓存</a>
          </li>
        
          <li>
            <a href="/2019/01/20/%E4%BD%BF%E7%94%A8NDK%E7%BC%96%E8%AF%91FFmpeg4-1/">使用NDK编译FFmpeg4.1</a>
          </li>
        
          <li>
            <a href="/2018/04/05/Zookeeper%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E9%80%89%E4%B8%BE%E6%9C%BA%E5%88%B6/">Zookeeper源码分析之选举机制</a>
          </li>
        
          <li>
            <a href="/2018/04/01/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAZooKeeper/">深入浅出ZooKeeper</a>
          </li>
        
          <li>
            <a href="/2018/03/03/%E8%81%8A%E8%81%8AGo-Channel/">聊聊Go Channel</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Binea<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>