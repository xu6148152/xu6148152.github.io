<!doctype html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Framework," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="BroadcastReceiver一般广播的使用，都是先注册，后发送。注册可以分为静态注册和动态注册
动态注册ContextImpl.registerReceiver123456@Override    public Intent registerReceiver(BroadcastReceiver receiver, IntentFilter filter,            String">
<meta property="og:type" content="article">
<meta property="og:title" content="源码角度分析BroadcastReceiver">
<meta property="og:url" content="http://xu6148152.github.io/2017/09/26/源码角度分析BroadcastReceiver/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="BroadcastReceiver一般广播的使用，都是先注册，后发送。注册可以分为静态注册和动态注册
动态注册ContextImpl.registerReceiver123456@Override    public Intent registerReceiver(BroadcastReceiver receiver, IntentFilter filter,            String">
<meta property="og:image" content="http://xu6148152.github.io/./register_receiver.png">
<meta property="og:image" content="http://xu6148152.github.io/./send_receiver.png">
<meta property="og:updated_time" content="2017-09-26T08:28:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="源码角度分析BroadcastReceiver">
<meta name="twitter:description" content="BroadcastReceiver一般广播的使用，都是先注册，后发送。注册可以分为静态注册和动态注册
动态注册ContextImpl.registerReceiver123456@Override    public Intent registerReceiver(BroadcastReceiver receiver, IntentFilter filter,            String">
<meta name="twitter:image" content="http://xu6148152.github.io/./register_receiver.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://xu6148152.github.io/2017/09/26/源码角度分析BroadcastReceiver/"/>





  <title> 源码角度分析BroadcastReceiver | Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://xu6148152.github.io/2017/09/26/源码角度分析BroadcastReceiver/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Binea">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/upload_file/tmp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                源码角度分析BroadcastReceiver
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-26T16:26:40+08:00">
                2017-09-26
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="BroadcastReceiver"><a href="#BroadcastReceiver" class="headerlink" title="BroadcastReceiver"></a>BroadcastReceiver</h3><p>一般广播的使用，都是先注册，后发送。注册可以分为静态注册和动态注册</p>
<h4 id="动态注册"><a href="#动态注册" class="headerlink" title="动态注册"></a>动态注册</h4><h5 id="ContextImpl-registerReceiver"><a href="#ContextImpl-registerReceiver" class="headerlink" title="ContextImpl.registerReceiver"></a>ContextImpl.registerReceiver</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Intent <span class="title">registerReceiver</span><span class="params">(BroadcastReceiver receiver, IntentFilter filter,</span></span></div><div class="line">            String broadcastPermission, Handler scheduler) &#123;</div><div class="line">        <span class="keyword">return</span> registerReceiverInternal(receiver, getUserId(),</div><div class="line">                filter, broadcastPermission, scheduler, getOuterContext(), <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<h5 id="ContextImpl-registerReceiverInternal"><a href="#ContextImpl-registerReceiverInternal" class="headerlink" title="ContextImpl.registerReceiverInternal"></a>ContextImpl.registerReceiverInternal</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> Intent <span class="title">registerReceiverInternal</span><span class="params">(BroadcastReceiver receiver, <span class="keyword">int</span> userId,</span></span></div><div class="line">            IntentFilter filter, String broadcastPermission,</div><div class="line">            Handler scheduler, Context context, <span class="keyword">int</span> flags) &#123;</div><div class="line">    IIntentReceiver rd = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">if</span> (receiver != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (mPackageInfo != <span class="keyword">null</span> &amp;&amp; context != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (scheduler == <span class="keyword">null</span>) &#123;</div><div class="line">                scheduler = mMainThread.getHandler();</div><div class="line">            &#125;</div><div class="line">            rd = mPackageInfo.getReceiverDispatcher(</div><div class="line">                receiver, context, scheduler,</div><div class="line">                mMainThread.getInstrumentation(), <span class="keyword">true</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (scheduler == <span class="keyword">null</span>) &#123;</div><div class="line">                scheduler = mMainThread.getHandler();</div><div class="line">            &#125;</div><div class="line">            rd = <span class="keyword">new</span> LoadedApk.ReceiverDispatcher(</div><div class="line">                    receiver, context, scheduler, <span class="keyword">null</span>, <span class="keyword">true</span>).getIIntentReceiver();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">final</span> Intent intent = ActivityManager.getService().registerReceiver(</div><div class="line">                mMainThread.getApplicationThread(), mBasePackageName, rd, filter,</div><div class="line">                broadcastPermission, userId, flags);</div><div class="line">        <span class="keyword">if</span> (intent != <span class="keyword">null</span>) &#123;</div><div class="line">            intent.setExtrasClassLoader(getClassLoader());</div><div class="line">            intent.prepareToEnterProcess();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> intent;</div><div class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">        <span class="keyword">throw</span> e.rethrowFromSystemServer();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>通过<code>ContextImpl</code>注册。创建<code>IIntentReceiver</code>，然后通过<code>ActivityManagerService</code>注册广播</p>
<h5 id="AMS-registerReceiver"><a href="#AMS-registerReceiver" class="headerlink" title="AMS.registerReceiver"></a>AMS.registerReceiver</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Intent <span class="title">registerReceiver</span><span class="params">(IApplicationThread caller, String callerPackage,</span></span></div><div class="line">            IIntentReceiver receiver, IntentFilter filter, String permission, <span class="keyword">int</span> userId,</div><div class="line">            <span class="keyword">int</span> flags) &#123;</div><div class="line">                ...</div><div class="line">            ReceiverList rl = mRegisteredReceivers.get(receiver.asBinder());</div><div class="line">            <span class="keyword">if</span> (rl == <span class="keyword">null</span>) &#123;</div><div class="line">                rl = <span class="keyword">new</span> ReceiverList(<span class="keyword">this</span>, callerApp, callingPid, callingUid,</div><div class="line">                        userId, receiver);</div><div class="line">                <span class="keyword">if</span> (rl.app != <span class="keyword">null</span>) &#123;</div><div class="line">                    rl.app.receivers.add(rl);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        receiver.asBinder().linkToDeath(rl, <span class="number">0</span>);</div><div class="line">                    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                        <span class="keyword">return</span> sticky;</div><div class="line">                    &#125;</div><div class="line">                    rl.linkedToDeath = <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">                mRegisteredReceivers.put(receiver.asBinder(), rl);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            ...</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> stickyCount = allSticky.size();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stickyCount; i++) &#123;</div><div class="line">                Intent intent = allSticky.get(i);</div><div class="line">                BroadcastQueue queue = broadcastQueueForIntent(intent);</div><div class="line">                BroadcastRecord r = <span class="keyword">new</span> BroadcastRecord(queue, intent, <span class="keyword">null</span>,</div><div class="line">                        <span class="keyword">null</span>, -<span class="number">1</span>, -<span class="number">1</span>, <span class="keyword">false</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, AppOpsManager.OP_NONE, <span class="keyword">null</span>, receivers,</div><div class="line">                        <span class="keyword">null</span>, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, -<span class="number">1</span>);</div><div class="line">                queue.enqueueParallelBroadcastLocked(r);</div><div class="line">                queue.scheduleBroadcastsLocked();</div><div class="line">            &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>检查是否是<code>sticky broadcast</code>。搜索已注册的广播，如果不存在，创建并缓存。通过每个广播意图，获取对应的前台广播队列或者后台广播队列。然后将新的广播信息入列</p>
<h5 id="BroadcastQueue-scheduleBroadcastsLocked"><a href="#BroadcastQueue-scheduleBroadcastsLocked" class="headerlink" title="BroadcastQueue.scheduleBroadcastsLocked"></a>BroadcastQueue.scheduleBroadcastsLocked</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduleBroadcastsLocked</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (DEBUG_BROADCAST) Slog.v(TAG_BROADCAST, <span class="string">"Schedule broadcasts ["</span></div><div class="line">            + mQueueName + <span class="string">"]: current="</span></div><div class="line">            + mBroadcastsScheduled);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (mBroadcastsScheduled) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    mHandler.sendMessage(mHandler.obtainMessage(BROADCAST_INTENT_MSG, <span class="keyword">this</span>));</div><div class="line">    mBroadcastsScheduled = <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>通过<code>Handler</code>来处理广播消息</p>
<h5 id="BroadcastQueue-processNextBroadcast"><a href="#BroadcastQueue-processNextBroadcast" class="headerlink" title="BroadcastQueue.processNextBroadcast"></a>BroadcastQueue.processNextBroadcast</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">processNextBroadcast</span><span class="params">(<span class="keyword">boolean</span> fromMsg)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">while</span> (mParallelBroadcasts.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">        r = mParallelBroadcasts.remove(<span class="number">0</span>);</div><div class="line">        ...</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> N = r.receivers.size();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">            Object target = r.receivers.get(i);</div><div class="line">            <span class="keyword">if</span> (DEBUG_BROADCAST)  Slog.v(TAG_BROADCAST,</div><div class="line">                    <span class="string">"Delivering non-ordered on ["</span> + mQueueName + <span class="string">"] to registered "</span></div><div class="line">                    + target + <span class="string">": "</span> + r);</div><div class="line">            deliverToRegisteredReceiverLocked(r, (BroadcastFilter)target, <span class="keyword">false</span>, i);</div><div class="line">        &#125;</div><div class="line">        addBroadcastToHistoryLocked(r);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div><div class="line">    performReceiveLocked(r.callerApp, r.resultTo,</div><div class="line">                                <span class="keyword">new</span> Intent(r.intent), r.resultCode,</div><div class="line">                                r.resultData, r.resultExtras, <span class="keyword">false</span>, <span class="keyword">false</span>, r.userId);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>首先处理所有无序广播，然后处理有序广播。之后调用<code>performReceiveLocked</code></p>
<h5 id="BroadcastQueue-performReceiveLocked"><a href="#BroadcastQueue-performReceiveLocked" class="headerlink" title="BroadcastQueue.performReceiveLocked"></a>BroadcastQueue.performReceiveLocked</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">performReceiveLocked</span><span class="params">(ProcessRecord app, IIntentReceiver receiver,</span></span></div><div class="line">            Intent intent, <span class="keyword">int</span> resultCode, String data, Bundle extras,</div><div class="line">            <span class="keyword">boolean</span> ordered, <span class="keyword">boolean</span> sticky, <span class="keyword">int</span> sendingUser) <span class="keyword">throws</span> RemoteException &#123;</div><div class="line">    <span class="comment">// Send the intent to the receiver asynchronously using one-way binder calls.</span></div><div class="line">    <span class="keyword">if</span> (app != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (app.thread != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// If we have an app thread, do the call through that so it is</span></div><div class="line">            <span class="comment">// correctly ordered with other one-way calls.</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                app.thread.scheduleRegisteredReceiver(receiver, intent, resultCode,</div><div class="line">                        data, extras, ordered, sticky, sendingUser, app.repProcState);</div><div class="line">            <span class="comment">// <span class="doctag">TODO:</span> Uncomment this when (b/28322359) is fixed and we aren't getting</span></div><div class="line">            <span class="comment">// DeadObjectException when the process isn't actually dead.</span></div><div class="line">            <span class="comment">//&#125; catch (DeadObjectException ex) &#123;</span></div><div class="line">            <span class="comment">// Failed to call into the process.  It's dying so just let it die and move on.</span></div><div class="line">            <span class="comment">//    throw ex;</span></div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException ex) &#123;</div><div class="line">                <span class="comment">// Failed to call into the process. It's either dying or wedged. Kill it gently.</span></div><div class="line">                <span class="keyword">synchronized</span> (mService) &#123;</div><div class="line">                    Slog.w(TAG, <span class="string">"Can't deliver broadcast to "</span> + app.processName</div><div class="line">                            + <span class="string">" (pid "</span> + app.pid + <span class="string">"). Crashing it."</span>);</div><div class="line">                    app.scheduleCrash(<span class="string">"can't deliver broadcast"</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">throw</span> ex;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// Application has died. Receiver doesn't exist.</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RemoteException(<span class="string">"app.thread must not be null"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        receiver.performReceive(intent, resultCode, data, extras, ordered,</div><div class="line">                sticky, sendingUser);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>如果<code>app</code>进程还存在，那么直接通知<code>ApplicationThread</code>处理消息，以保证广播的顺序。最终都是调用<code>IIntentReceiver</code></p>
<h5 id="LoadApk-ReceiverDispatcher-InnerReceiver"><a href="#LoadApk-ReceiverDispatcher-InnerReceiver" class="headerlink" title="LoadApk.ReceiverDispatcher.InnerReceiver"></a>LoadApk.ReceiverDispatcher.InnerReceiver</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performReceive</span><span class="params">(Intent intent, <span class="keyword">int</span> resultCode, String data,</span></span></div><div class="line">        Bundle extras, <span class="keyword">boolean</span> ordered, <span class="keyword">boolean</span> sticky, <span class="keyword">int</span> sendingUser) &#123;</div><div class="line">    <span class="keyword">final</span> LoadedApk.ReceiverDispatcher rd;</div><div class="line">    <span class="keyword">if</span> (intent == <span class="keyword">null</span>) &#123;</div><div class="line">        Log.wtf(TAG, <span class="string">"Null intent received"</span>);</div><div class="line">        rd = <span class="keyword">null</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        rd = mDispatcher.get();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (ActivityThread.DEBUG_BROADCAST) &#123;</div><div class="line">        <span class="keyword">int</span> seq = intent.getIntExtra(<span class="string">"seq"</span>, -<span class="number">1</span>);</div><div class="line">        Slog.i(ActivityThread.TAG, <span class="string">"Receiving broadcast "</span> + intent.getAction()</div><div class="line">                + <span class="string">" seq="</span> + seq + <span class="string">" to "</span> + (rd != <span class="keyword">null</span> ? rd.mReceiver : <span class="keyword">null</span>));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (rd != <span class="keyword">null</span>) &#123;</div><div class="line">        rd.performReceive(intent, resultCode, data, extras,</div><div class="line">                ordered, sticky, sendingUser);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// The activity manager dispatched a broadcast to a registered</span></div><div class="line">        <span class="comment">// receiver in this process, but before it could be delivered the</span></div><div class="line">        <span class="comment">// receiver was unregistered.  Acknowledge the broadcast on its</span></div><div class="line">        <span class="comment">// behalf so that the system's broadcast sequence can continue.</span></div><div class="line">        <span class="keyword">if</span> (ActivityThread.DEBUG_BROADCAST) Slog.i(ActivityThread.TAG,</div><div class="line">                <span class="string">"Finishing broadcast to unregistered receiver"</span>);</div><div class="line">        IActivityManager mgr = ActivityManager.getService();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (extras != <span class="keyword">null</span>) &#123;</div><div class="line">                extras.setAllowFds(<span class="keyword">false</span>);</div><div class="line">            &#125;</div><div class="line">            mgr.finishReceiver(<span class="keyword">this</span>, resultCode, data, extras, <span class="keyword">false</span>, intent.getFlags());</div><div class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">            <span class="keyword">throw</span> e.rethrowFromSystemServer();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>通过<code>IPC</code>从<code>AMS</code>通讯回到<code>LoadedApk</code></p>
<h4 id="静态注册"><a href="#静态注册" class="headerlink" title="静态注册"></a>静态注册</h4><p>在<code>AndroidManifest.xml</code>中注册广播。广播发出后，会经由<code>PackageManagerService</code>获取当前进程的所有配置信息，然后会做比对</p>
<h4 id="广播发送"><a href="#广播发送" class="headerlink" title="广播发送"></a>广播发送</h4><h5 id="AMS-broadcastIntent"><a href="#AMS-broadcastIntent" class="headerlink" title="AMS.broadcastIntent"></a>AMS.broadcastIntent</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">broadcastIntent</span><span class="params">(IApplicationThread caller,</span></span></div><div class="line">            Intent intent, String resolvedType, IIntentReceiver resultTo,</div><div class="line">            <span class="keyword">int</span> resultCode, String resultData, Bundle resultExtras,</div><div class="line">            String[] requiredPermissions, <span class="keyword">int</span> appOp, Bundle bOptions,</div><div class="line">            <span class="keyword">boolean</span> serialized, <span class="keyword">boolean</span> sticky, <span class="keyword">int</span> userId) &#123;</div><div class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</div><div class="line">            intent = verifyBroadcastLocked(intent);</div><div class="line">            ...</div><div class="line">            <span class="keyword">int</span> res = broadcastIntentLocked(callerApp,</div><div class="line">                    callerApp != <span class="keyword">null</span> ? callerApp.info.packageName : <span class="keyword">null</span>,</div><div class="line">                    intent, resolvedType, resultTo, resultCode, resultData, resultExtras,</div><div class="line">                    requiredPermissions, appOp, bOptions, serialized, sticky,</div><div class="line">                    callingPid, callingUid, userId);</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>校验广播意图</p>
<h5 id="AMS-broadcastIntentLocked"><a href="#AMS-broadcastIntentLocked" class="headerlink" title="AMS.broadcastIntentLocked"></a>AMS.broadcastIntentLocked</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">broadcastIntentLocked</span><span class="params">(ProcessRecord callerApp,</span></span></div><div class="line">            String callerPackage, Intent intent, String resolvedType,</div><div class="line">            IIntentReceiver resultTo, <span class="keyword">int</span> resultCode, String resultData,</div><div class="line">            Bundle resultExtras, String[] requiredPermissions, <span class="keyword">int</span> appOp, Bundle bOptions,</div><div class="line">            <span class="keyword">boolean</span> ordered, <span class="keyword">boolean</span> sticky, <span class="keyword">int</span> callingPid, <span class="keyword">int</span> callingUid, <span class="keyword">int</span> userId) &#123;</div><div class="line">                ...</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (!ordered &amp;&amp; NR &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// If we are not serializing this broadcast, then send the</span></div><div class="line">            <span class="comment">// registered receivers separately so they don't wait for the</span></div><div class="line">            <span class="comment">// components to be launched.</span></div><div class="line">            <span class="keyword">if</span> (isCallerSystem) &#123;</div><div class="line">                checkBroadcastFromSystem(intent, callerApp, callerPackage, callingUid,</div><div class="line">                        isProtectedBroadcast, registeredReceivers);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">final</span> BroadcastQueue queue = broadcastQueueForIntent(intent);</div><div class="line">            BroadcastRecord r = <span class="keyword">new</span> BroadcastRecord(queue, intent, callerApp,</div><div class="line">                    callerPackage, callingPid, callingUid, callerInstantApp, resolvedType,</div><div class="line">                    requiredPermissions, appOp, brOptions, registeredReceivers, resultTo,</div><div class="line">                    resultCode, resultData, resultExtras, ordered, sticky, <span class="keyword">false</span>, userId);</div><div class="line">            <span class="keyword">if</span> (DEBUG_BROADCAST) Slog.v(TAG_BROADCAST, <span class="string">"Enqueueing parallel broadcast "</span> + r);</div><div class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> replaced = replacePending</div><div class="line">                    &amp;&amp; (queue.replaceParallelBroadcastLocked(r) != <span class="keyword">null</span>);</div><div class="line">            <span class="comment">// Note: We assume resultTo is null for non-ordered broadcasts.</span></div><div class="line">            <span class="keyword">if</span> (!replaced) &#123;</div><div class="line">                queue.enqueueParallelBroadcastLocked(r);</div><div class="line">                queue.scheduleBroadcastsLocked();</div><div class="line">            &#125;</div><div class="line">            registeredReceivers = <span class="keyword">null</span>;</div><div class="line">            NR = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>首先处理系统的广播消息。然后将广播消息入队列</p>
<h5 id="BroadCastQueue-processNextBroadcast"><a href="#BroadCastQueue-processNextBroadcast" class="headerlink" title="BroadCastQueue.processNextBroadcast"></a>BroadCastQueue.processNextBroadcast</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">processNextBroadcast</span><span class="params">(<span class="keyword">boolean</span> fromMsg)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">if</span> (app != <span class="keyword">null</span> &amp;&amp; app.thread != <span class="keyword">null</span> &amp;&amp; !app.killed) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            app.addPackage(info.activityInfo.packageName,</div><div class="line">                    info.activityInfo.applicationInfo.versionCode, mService.mProcessStats);</div><div class="line">            processCurBroadcastLocked(r, app);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>如果当前进程还在，那么处理当前广播</p>
<h5 id="BroadCastQueue-processCurBroadcastLocked"><a href="#BroadCastQueue-processCurBroadcastLocked" class="headerlink" title="BroadCastQueue.processCurBroadcastLocked"></a>BroadCastQueue.processCurBroadcastLocked</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">processCurBroadcastLocked</span><span class="params">(BroadcastRecord r,</span></span></div><div class="line">            ProcessRecord app) <span class="keyword">throws</span> RemoteException &#123;</div><div class="line">                ...</div><div class="line">                app.thread.scheduleReceiver(<span class="keyword">new</span> Intent(r.intent), r.curReceiver,</div><div class="line">                    mService.compatibilityInfoForPackageLocked(r.curReceiver.applicationInfo),</div><div class="line">                    r.resultCode, r.resultData, r.resultExtras, r.ordered, r.userId,</div><div class="line">                    app.repProcState);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>如果当前进程正在备份，那么忽略广播。更新进程状态，调整优先级。然后通知<code>ApplicationThread</code>处理广播</p>
<h5 id="ActivityThread-handleReceiver"><a href="#ActivityThread-handleReceiver" class="headerlink" title="ActivityThread.handleReceiver"></a>ActivityThread.handleReceiver</h5><p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleReceiver</span><span class="params">(ReceiverData data)</span> </span>&#123;</div><div class="line">    <span class="comment">// If we are getting ready to gc after going to the background, well</span></div><div class="line">    <span class="comment">// we are back active so skip it.</span></div><div class="line">    unscheduleGcIdler();</div><div class="line"></div><div class="line">    String component = data.intent.getComponent().getClassName();</div><div class="line"></div><div class="line">    LoadedApk packageInfo = getPackageInfoNoCheck(</div><div class="line">            data.info.applicationInfo, data.compatInfo);</div><div class="line"></div><div class="line">    IActivityManager mgr = ActivityManager.getService();</div><div class="line"></div><div class="line">    Application app;</div><div class="line">    BroadcastReceiver receiver;</div><div class="line">    ContextImpl context;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        app = packageInfo.makeApplication(<span class="keyword">false</span>, mInstrumentation);</div><div class="line">        context = (ContextImpl) app.getBaseContext();</div><div class="line">        <span class="keyword">if</span> (data.info.splitName != <span class="keyword">null</span>) &#123;</div><div class="line">            context = (ContextImpl) context.createContextForSplit(data.info.splitName);</div><div class="line">        &#125;</div><div class="line">        java.lang.ClassLoader cl = context.getClassLoader();</div><div class="line">        data.intent.setExtrasClassLoader(cl);</div><div class="line">        data.intent.prepareToEnterProcess();</div><div class="line">        data.setExtrasClassLoader(cl);</div><div class="line">        receiver = (BroadcastReceiver)cl.loadClass(component).newInstance();</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="keyword">if</span> (DEBUG_BROADCAST) Slog.i(TAG,</div><div class="line">                <span class="string">"Finishing failed broadcast to "</span> + data.intent.getComponent());</div><div class="line">        data.sendFinished(mgr);</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">            <span class="string">"Unable to instantiate receiver "</span> + component</div><div class="line">            + <span class="string">": "</span> + e.toString(), e);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">if</span> (localLOGV) Slog.v(</div><div class="line">            TAG, <span class="string">"Performing receive of "</span> + data.intent</div><div class="line">            + <span class="string">": app="</span> + app</div><div class="line">            + <span class="string">", appName="</span> + app.getPackageName()</div><div class="line">            + <span class="string">", pkg="</span> + packageInfo.getPackageName()</div><div class="line">            + <span class="string">", comp="</span> + data.intent.getComponent().toShortString()</div><div class="line">            + <span class="string">", dir="</span> + packageInfo.getAppDir());</div><div class="line"></div><div class="line">        sCurrentBroadcastIntent.set(data.intent);</div><div class="line">        receiver.setPendingResult(data);</div><div class="line">        receiver.onReceive(context.getReceiverRestrictedContext(),</div><div class="line">                data.intent);</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="keyword">if</span> (DEBUG_BROADCAST) Slog.i(TAG,</div><div class="line">                <span class="string">"Finishing failed broadcast to "</span> + data.intent.getComponent());</div><div class="line">        data.sendFinished(mgr);</div><div class="line">        <span class="keyword">if</span> (!mInstrumentation.onException(receiver, e)) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">                <span class="string">"Unable to start receiver "</span> + component</div><div class="line">                + <span class="string">": "</span> + e.toString(), e);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        sCurrentBroadcastIntent.set(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (receiver.getPendingResult() != <span class="keyword">null</span>) &#123;</div><div class="line">        data.finish();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</p>
<p>通过反射，创建广播对象，然后调用<code>onReceive</code></p>
<h3 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h3><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><p><img src="./register_receiver.png" alt="register"></p>
<h4 id="发送"><a href="#发送" class="headerlink" title="发送"></a>发送</h4><p><img src="./send_receiver.png" alt="send"></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Framework/" rel="tag"># Framework</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/15/源码角度分析App启动/" rel="next" title="源码角度分析App启动">
                <i class="fa fa-chevron-left"></i> 源码角度分析App启动
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/10/02/插件化原理解析Hook动态代理/" rel="prev" title="插件化原理解析Hook动态代理">
                插件化原理解析Hook动态代理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Inhaltsverzeichnis
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Übersicht
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/upload_file/tmp.jpg"
               alt="Binea" />
          <p class="site-author-name" itemprop="name">Binea</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">57</span>
                <span class="site-state-item-name">Artikel</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#BroadcastReceiver"><span class="nav-number">1.</span> <span class="nav-text">BroadcastReceiver</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#动态注册"><span class="nav-number">1.1.</span> <span class="nav-text">动态注册</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ContextImpl-registerReceiver"><span class="nav-number">1.1.1.</span> <span class="nav-text">ContextImpl.registerReceiver</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ContextImpl-registerReceiverInternal"><span class="nav-number">1.1.2.</span> <span class="nav-text">ContextImpl.registerReceiverInternal</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#AMS-registerReceiver"><span class="nav-number">1.1.3.</span> <span class="nav-text">AMS.registerReceiver</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BroadcastQueue-scheduleBroadcastsLocked"><span class="nav-number">1.1.4.</span> <span class="nav-text">BroadcastQueue.scheduleBroadcastsLocked</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BroadcastQueue-processNextBroadcast"><span class="nav-number">1.1.5.</span> <span class="nav-text">BroadcastQueue.processNextBroadcast</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BroadcastQueue-performReceiveLocked"><span class="nav-number">1.1.6.</span> <span class="nav-text">BroadcastQueue.performReceiveLocked</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#LoadApk-ReceiverDispatcher-InnerReceiver"><span class="nav-number">1.1.7.</span> <span class="nav-text">LoadApk.ReceiverDispatcher.InnerReceiver</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#静态注册"><span class="nav-number">1.2.</span> <span class="nav-text">静态注册</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#广播发送"><span class="nav-number">1.3.</span> <span class="nav-text">广播发送</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#AMS-broadcastIntent"><span class="nav-number">1.3.1.</span> <span class="nav-text">AMS.broadcastIntent</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#AMS-broadcastIntentLocked"><span class="nav-number">1.3.2.</span> <span class="nav-text">AMS.broadcastIntentLocked</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BroadCastQueue-processNextBroadcast"><span class="nav-number">1.3.3.</span> <span class="nav-text">BroadCastQueue.processNextBroadcast</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BroadCastQueue-processCurBroadcastLocked"><span class="nav-number">1.3.4.</span> <span class="nav-text">BroadCastQueue.processCurBroadcastLocked</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ActivityThread-handleReceiver"><span class="nav-number">1.3.5.</span> <span class="nav-text">ActivityThread.handleReceiver</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#时序图"><span class="nav-number">2.</span> <span class="nav-text">时序图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#注册"><span class="nav-number">2.1.</span> <span class="nav-text">注册</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#发送"><span class="nav-number">2.2.</span> <span class="nav-text">发送</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Binea</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid="></script>
      <!-- UY END -->
  




  
  

  

  

  

  


</body>
</html>
